apply plugin: "maven-publish"
apply plugin: 'signing'

publishing {
    publications {
		Galacticraft(MavenPublication) {
			groupId 'micdoodle8.mods'
			artifactId 'galacticraft'
			version project.version.split("-")[1]

			artifact jar
            artifact deobfJar
            artifact sourcesJar
            artifact apiJar
            
            pom {
				name = 'Galacticraft'
				description = 'An advanced space exploration mod for Minecraft'
				url = 'https://github.com/TeamGalacticraft/Galacticraft-Legacy'
				scm {
					url = 'https://github.com/TeamGalacticraft/Galacticraft-Legacy'
					connection = 'scm:git:git://github.com/TeamGalacticraft/Galacticraft-Legacy.git'
					developerConnection = 'scm:git:git@github.com:TeamGalacticraft/Galacticraft-Legacy.git'
				}
				issueManagement {
					system = 'github'
					url = 'https://github.com/TeamGalacticraft/Galacticraft-Legacy/issues'
				}

				licenses {
					license {
						name = 'custom'
						url = 'https://github.com/TeamGalacticraft/Galacticraft-Legacy/blob/master/LICENSE.txt'
					}
				}
			}
		}
    }
    repositories {
		maven {
			name = 'external'
			url = 'https://maven.galacticraft.dev/releases'
			authentication {
                basic(BasicAuthentication)
            }
			credentials {
                username = System.getenv('MAVEN_USER')
                password = System.getenv('MAVEN_PASSWORD')
			}
		}
    }

    signing {
    	publishing.publications.each {
    	    sign it
    	}
    }
}

tasks.register('PublishToGalacticraftMaven') {
    group = 'script-tasks'
    description = 'Publishes the Galacticraft publication to the Galacticraft Maven repository.'
    dependsOn tasks.withType(PublishToMavenRepository).matching {
        it.repository == publishing.repositories.external
        
		def ver = it.publication.version
		def group = it.publication.groupId
		def artifact = it.publication.artifactId
	
		println('************************************************************************')
		println('')
		println("  compile " + group + ":" + group + ":" + ver)
		println("  imlementation " + group + ":" + group + ":" + ver)
		println('')
		println('************************************************************************')
    }
}
